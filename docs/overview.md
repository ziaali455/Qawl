# Qawl - Islamic Audio Platform Overview

*Last updated: Jul 3 2025*  
*Generated by AI*

## Project Overview

Qawl is a Flutter-based mobile application designed as an Islamic audio platform for Quranic recitations. The app allows users to discover, listen to, and share Quranic recitations from various reciters (Qaris) around the world. It features a social aspect with user profiles, following mechanisms, and playlist management.

## Project Structure

### Core Architecture
- **Framework**: Flutter (Dart)
- **State Management**: Flutter BLoC pattern with Provider
- **Architecture Pattern**: Feature-based modular architecture
- **Platform Support**: iOS, Android, Web, macOS, Windows, Linux

### Directory Structure
```
lib/
├── blocs/                    # State management (BLoC pattern)
│   └── now_playing/         # Audio player state management
├── model/                   # Data models and business logic
├── screens/                 # UI screens and pages
├── services/                # Business services and utilities
├── widgets/                 # Reusable UI components
├── deprecated/              # Legacy code (to be removed)
├── constants.dart           # App-wide constants
├── firebase_options.dart    # Firebase configuration
├── main.dart               # App entry point
└── size_config.dart        # Responsive design utilities
```

## App Flow

### 1. Authentication Flow
```
Splash Screen → Authentication Check → Login/Registration → User Setup → Home
```

**Authentication Methods:**
- Email/Password authentication
- Google Sign-In
- Apple Sign-In (iOS)
- Firebase Authentication integration

**User Setup Process:**
- Name input (required)
- Country selection (optional)
- Gender selection (optional)
- Profile photo upload (optional)

### 2. Main App Navigation
The app uses a bottom navigation bar with three main sections:

1. **Home Tab** (`HomePageContent`)
   - Personal playlists (Favorites, Following)
   - User's collections
   - Quick access to user's library

2. **Explore Tab** (`ExploreContent`)
   - Search functionality
   - Categories (Nations, Trending, Styles, Following)
   - Top 100 recitations
   - New releases (conditionally shown)
   - Popular reciters

3. **Profile Tab** (`ProfileContent`)
   - User profile information
   - Uploads and collections
   - Settings and account management

### 3. Audio Playback Flow
```
Track Selection → Now Playing Screen → Background Audio → Notification Controls
```

## Services & APIs

### Firebase Services

#### 1. Firebase Authentication
- **Purpose**: User authentication and session management
- **Features**:
  - Email/password authentication
  - Google OAuth integration
  - Apple Sign-In integration
  - Session persistence
  - User state management

#### 2. Cloud Firestore
- **Purpose**: NoSQL database for user data and content
- **Collections**:
  - `QawlUsers`: User profiles and metadata
  - `QawlTracks`: Audio track metadata and information
  - User-generated playlists and collections

**Key Features**:
- Real-time data synchronization
- Offline support
- Complex queries with gender-based filtering
- User relationship management (following/followers)

#### 3. Firebase Storage
- **Purpose**: File storage for audio files and images
- **Structure**:
  - Audio files: User uploads and quiz assets
  - Profile images: User profile pictures
  - Default images: App default assets

#### 4. Firebase Cloud Functions
- **Purpose**: Server-side business logic
- **Location**: `functions/` directory
- **Features**: Background processing and API endpoints

#### 5. Firebase Messaging
- **Purpose**: Push notifications
- **Features**: Background message handling and user engagement

### Audio Services

#### 1. Just Audio
- **Purpose**: Cross-platform audio playback
- **Features**:
  - Background audio playback
  - Audio session management
  - Progress tracking
  - Volume control

#### 2. Just Audio Background
- **Purpose**: Background audio with system notifications
- **Features**:
  - Lock screen controls
  - Notification media controls
  - Background playback persistence

#### 3. Unified Audio Manager
- **Purpose**: Centralized audio management service
- **Features**:
  - Main audio and quiz audio handling
  - Audio session configuration
  - Interruption handling
  - State management

### State Management

#### Flutter BLoC Pattern
- **NowPlayingBloc**: Manages audio player state
- **Events**: Audio control events (play, pause, seek, etc.)
- **States**: Current audio state and metadata

## Key Packages & Dependencies

### Core Dependencies
```yaml
# Audio
just_audio: ^0.9.33                    # Audio playback
just_audio_background: ^0.0.1-beta.12  # Background audio
audio_service: ^0.18.0                 # Audio service integration
rxdart: ^0.27.5                        # Reactive programming

# Firebase
firebase_core: ^3.14.0                 # Firebase initialization
firebase_auth: ^5.6.0                  # Authentication
cloud_firestore: ^5.6.9                # Database
firebase_storage: ^12.4.7              # File storage
firebase_messaging: ^15.2.7            # Push notifications

# State Management
flutter_bloc: ^9.1.1                   # BLoC pattern
provider: ^6.0.5                       # Dependency injection

# UI & Navigation
google_nav_bar: ^5.0.6                 # Bottom navigation
modal_bottom_sheet: ^2.1.2             # Modal sheets
widget_and_text_animator:              # UI animations
flex_color_scheme: ^8.2.0              # Theme management

# Media & Files
image_picker: ^1.0.7                   # Image selection
file_picker: ^8.0.7                    # File selection
cached_network_image: ^3.3.1           # Image caching
flutter_audio_waveforms: ^1.2.1+8      # Audio visualization

# Authentication
google_sign_in: ^6.2.1                 # Google OAuth
sign_in_with_apple:                    # Apple Sign-In
firebase_ui_auth: ^1.17.0              # Firebase UI auth

# Utilities
uuid: ^3.0.4                           # Unique identifiers
shared_preferences: ^2.3.3             # Local storage
path_provider: ^2.1.1                  # File system access
url_launcher: ^6.3.0                   # URL handling
share_plus: ^10.0.0                    # Content sharing
uni_links: ^0.5.1                      # Deep linking
```

## Data Models

### Core Models

#### QawlUser
- User profile information
- Authentication data
- Social relationships (following/followers)
- Library management (private/public)

#### Track
- Audio track metadata
- Recitation information (Surah, style)
- User association
- Play count and statistics

#### QawlPlaylist
- Collection of tracks
- User ownership
- Privacy settings
- Metadata (name, description)

## Features

### Core Features
1. **Audio Playback**
   - Background audio with notifications
   - Playlist management
   - Progress tracking and seeking
   - Audio session management

2. **Social Features**
   - User profiles and following
   - Content discovery
   - User-generated playlists
   - Content sharing

3. **Content Discovery**
   - Search functionality
   - Categorized browsing
   - Top charts and new releases
   - Geographic exploration (by country)

4. **User Management**
   - Authentication and authorization
   - Profile customization
   - Library management
   - Content upload (with verification)

### Advanced Features
1. **Quiz System**
   - Tajweed verification quizzes
   - Audio-based questions
   - User verification process

2. **Deep Linking**
   - Track sharing via URLs
   - App-to-app navigation
   - External link handling

3. **Responsive Design**
   - Cross-platform compatibility
   - Adaptive layouts
   - Screen size optimization

## Security & Privacy

### Firebase Security Rules
- **Firestore**: Currently open (development mode)
- **Storage**: Currently open (development mode)
- **Authentication**: Firebase Auth managed

### Data Privacy
- User gender-based content filtering
- Private library support
- User consent for data collection

## Performance Considerations

### Audio Optimization
- Streaming audio playback
- Background audio session management
- Memory-efficient audio handling
- Caching strategies

### UI Performance
- Lazy loading for large lists
- Image caching and optimization
- Efficient state management
- Minimal rebuilds with BLoC

## Development & Deployment

### Build Configuration
- **Version**: 1.0.4
- **Platform Support**: Multi-platform
- **Firebase Project**: qawl-io-8c4ff

### Development Tools
- **Linting**: flutter_lints
- **Testing**: flutter_test
- **Analysis**: analysis_options.yaml

### Deployment
- **iOS**: App Store deployment ready
- **Android**: Google Play Store ready
- **Web**: Progressive Web App capabilities
- **Desktop**: macOS, Windows, Linux support

## Future Considerations

### Scalability
- Implement proper Firebase security rules
- Add content moderation systems
- Optimize for large user bases
- Implement CDN for audio delivery

### Features
- Real-time messaging
- Live streaming capabilities
- Advanced analytics
- Multi-language support
- Offline mode enhancements

### Technical Debt
- Remove deprecated code
- Implement proper error handling
- Add comprehensive testing
- Optimize bundle size
- Implement proper logging and monitoring
